FROM node:18-alpine

WORKDIR /app

# Copy root package files for workspace setup
COPY package.json package-lock.json ./
COPY turbo.json ./

# Copy shared-types package
COPY packages/shared-types ./packages/shared-types

# Copy web package files
COPY web/package.json ./web/

# Install all dependencies (workspace-aware)
RUN npm install

# Build shared-types first
RUN npm run build --workspace=@carbon-tracker/shared-types

# Copy web source
COPY web ./web

# Set working directory to web
WORKDIR /app/web

# Expose Vite dev server port
EXPOSE 3000

# Start dev server
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0", "--port", "3000"]

